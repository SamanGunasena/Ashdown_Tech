{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
    <h1 class="text-center">Admin Dashboard</h1>
<div>
    <h3>Users</h3>
    <table class="table">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.firstname }}</td>
                <td>{{ user.lastname }}</td>
                <td>{{ user.email }}</td>
                <td>{{ 'Approved' if user.is_approved else 'Unapproved' }}</td>
                <td>
                    {% if not user.is_approved %}
                        <a href="{{ url_for('approve_user', user_id=user.id) }}" class="btn btn-success">Approve</a>
                    {% endif %}
                    <a href="{{ url_for('delete_user', user_id=user.id) }}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this user?');">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
<div>
<h3>Posts</h3>
<table class="table">
    <thead>
    <tr>
        <th> ID</th>
        <th> Title</th>
        <th> Content</th>
        <th> Author</th>
        <th> Files</th>
        <th> Action </th>
    </tr>

    </thead>
    <tbody>
    {% for post in posts %}
    <tr>
        <td> {{ post.id }} </td>
        <td> {{ post.title }} </td>
        <td> {{ post.content }} </td>
        <td> {{ post.author }} </td>
        <td> {{ post.filename }} </td>
        <td> <a href="{{ url_for('delete_post', post_id=post.id) }}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this user?');">Delete</a></td>

    </tr>



    {% endfor %}



    </tbody>

</table>
    </div>
<div class="container mt-5">
    <h3>Q and A</h3>
    {% if questions_with_answers %}
        <ul class="list-group">
            {% for qna in questions_with_answers %}
                <li class="list-group-item">
                    <h5>Q: {{ qna['question']|e }}</h5>
                    <h6>{{ qna['created_at']|e }}</h6>

                    <!-- Display all answers related to the question -->
                    <ul class="list-group mt-2">
                        {% for answer in qna['answers'] %}
                            <li class="list-group-item">
                                <p>{{ answer['answer']|e }}</p>
                                {% if answer['attachment'] %}
                                    <p>
                                        <a href="{{ url_for('static', filename='uploads/' ~ answer['attachment']) }}" download>Download Attachment</a>
                                    </p>
                                {% endif %}
                                <small>Answered by {{ answer['author']|e }} on {{ answer['created_at'] }}</small>
                            </li>
                        {% else %}
                            <li class="list-group-item">No answers yet.</li>
                        {% endfor %}
                    </ul>
                    <form action="{{ url_for('delete_question', question_id=qna['id']) }}" method="POST" class="d-inline-block" onsubmit="return confirm('Are you sure you want to delete this question and all its related answers?');">

                        <button type="submit" class="btn btn-danger btn-sm">Delete Question</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No questions have been asked yet.</p>
    {% endif %}
</div>

<button onclick="topFunction()" id="backToTopBtn" class="btn btn-primary btn-lg" title="Go to top">
    <i class="bi bi-arrow-up"></i> <!-- Bootstrap icon -->
</button>
{% endblock %}
